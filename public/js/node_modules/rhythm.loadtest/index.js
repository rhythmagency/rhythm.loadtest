'use strict';

var CONST = require('./lib/constants'),
	Templates = require('./lib/templates/templates'),
	$ = window.$ = window.jQuery = require('jquery-browser/lib/jquery');

// Twitter Bootstrap
require('./vendor/bootstrap/transition');
require('./vendor/bootstrap/alert');
require('./vendor/bootstrap/modal');
require('./vendor/bootstrap/dropdown');
require('./vendor/bootstrap/scrollspy');
require('./vendor/bootstrap/tab');
require('./vendor/bootstrap/tooltip');
require('./vendor/bootstrap/popover');
require('./vendor/bootstrap/button');
require('./vendor/bootstrap/collapse');
require('./vendor/bootstrap/carousel');
require('./vendor/bootstrap/affix');

// Flat UI
require('./vendor/flat-ui/bootstrap-select');

// jQuery plugins
require('./lib/jquery/jquery.serializeObject')($);

// Socket.io
var io = require('socket.io-client'),
	socket = io.connect('http://localhost:9000');

// Initialization
$(function () {
	var $submit = $('#submit'),
		$results = $('.results'),
		$form = $('form'),
		$select = $('select'),
		$tooltip = $('[data-toggle="tooltip"]'),
		fnResetSubmit = function () {
			$submit.button('reset');

			setTimeout(function () {
				$submit.button('reset');
			}, 2000);
		}

	$tooltip.tooltip({'placement': 'top'});

	$select.selectpicker();

	$form.on(CONST.EVENTS.SUBMIT, function (e) {
		var options = $(this).serializeObject();

		$submit.button('loading');
		socket.emit('start', options);

		e.preventDefault();
	});

	socket.on(CONST.EVENTS.ERROR, function (err) {
		fnResetSubmit();
		$results.prepend(Templates['result-error']({'data': err}));
		console.log(err);
	});

	socket.on(CONST.EVENTS.RESULT, function (result) {
		fnResetSubmit();
		$results.prepend(Templates['result-success']({'data': result}));
		console.log(result);
	});
});